#!/bin/sh
main_scratchpad_id()
{
  kwmc query scratchpad list | sed -n -E "s/([0-9]+).*iTerm2.*/\1/p"
}

pad_id="$(main_scratchpad_id)"
if [[ -n "$pad_id" ]]; then
  osascript <<APPLESCRIPT
    tell application "iTerm2"
      repeat with aWindow in windows
        repeat with aTab in tabs of aWindow
          repeat with aSession in sessions of aTab
            if (profile name of aSession as string) = "scratchpad" then
              tell aWindow to select
              do shell script "kwmc scratchpad toggle ${pad_id}"
              return
            end if
          end repeat
        end repeat
      end repeat
    end tell
APPLESCRIPT
  exit
fi

osascript <<APPLESCRIPT
  activate application "iTerm2"
  tell application "iTerm2"
    set padWindow to (create window with profile "scratchpad")
    select padWindow
    delay 1
    do shell script "kwmc scratchpad add"
  end tell
APPLESCRIPT
